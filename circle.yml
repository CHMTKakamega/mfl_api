machine:
    environment:
        DATABASE_URL: postgres://ubuntu@localhost:5432/circle_test
        COVERALLS_REPO_TOKEN: Di6cfRDQKGKrOaNNfO8vTMMC28gHGZYA2

    services:
        - elasticsearch


checkout:
    post:
        - cp .env-example .env


dependencies:
    pre:
        - sudo apt-get -y update
        - sudo apt-get -y autoclean
        - sudo apt-get -y autoremove

    post:
        - pip install fabric


test:
    override:
        # test code
        - case $CIRCLECI_NODE_INDEX in 0) fab test ;; 1) ansible-playbook -i inventory site.yml --connection=local ;; esac:
            pwd: playbooks
            parallel: true


general:
    artifacts:
        - "htmlcov"
